<!DOCTYPE html>
<html lang="en">
<head>
	<title>2017 PyConTW Talk</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- css style -->
	<link rel="stylesheet" href="lib/shower/themes/styles/screen-16x10.css">
	<link rel="stylesheet" href="lib/highlight/styles/github.css" type="text/css"/>
	<!--<link rel="stylesheet" href="shower/themes/material/styles/screen-16x10.css">
	<link rel="stylesheet" href="lib/highlight/styles/github.css" type="text/css"/>-->
</head>
<body class="shower list">

	<header class="caption">
		<h1>PyConTW 2017 TALK 用 Django 建立一個可以設定爬蟲排程任務與監控的網站</h1>
		<p>2017-06-11, <a href="https://chairco.github.io">YiChieh Chen(Jason)</p>
	</header>

	<section class="slide no-number" id="cover">
		<h2>用 Django 建立一個可以設定爬蟲排程任務與監控的網站</h2>
		<p>2017-06-11, <a href="https://chairco.github.io">YiChieh Chen(Jason)</a></p>
		<figure>
			<img class="cover" src="pictures/cover.jpg" alt="Hands on the orange typewriter in a park">
			<figcaption class="white">
				<a href="https://chairco.github.io/2017Talk-Django-crawler-monitor/">© YiChieh Chen</a>
			</figcaption>
		</figure>
		<style>
			#cover h2 {
				margin:30px 0 0;
				color:#FFF;
				text-align:center;
				font-size:60px;
				}
			#cover p {
				margin:10px 0 0;
				text-align:center;
				color:#FFF;
				font-style:italic;
				font-size:30px;
				}
				#cover p a {
					color:#FFF;
					}
		</style>
	</section>

	<section id="about-me" class="slide no-number twocol l60">
		<div class="right">
			<h2>About Me</h2>
			<ul>
				<li>YiChieh(Jason)</li>
				<li>Master degree at the graduate school of Institute of Healthcare Information Management in CCU</li>
				<li>Program Chair of PyCon Taiwan 2017</li>
			</ul>
		</div>
		<div class="left">
			<div class="citation">
				<img class="fill w" src="pictures/me.jpg" alt="">
			</div>
		</div>
	</section>

	<section class="slide">
		<h2>Outline</h2>
		<ul>
			<li class="next">排程任務、工具、相關框架</li>
			<li class="next">用 Django 建立一個排程任務網站</li>
			<li class="next">爬蟲程式範例</li>
			<li class="next">任務程式範例</li>
			<li class="next">前端設計</li>
			<li class="next">如何透過 Django-Admin 建立任務</li>
			<li class="next">Demo</li>
		</ul>
		<p class="note">Shower ['ʃəuə] noun. A person or thing that shows.</p>
	</section>

	<section class="slide">
		<h2>Story as background </h2>
		<p>公司與工廠間再生產產品期間時需要經常即時的傳遞零組件資料，這些資料存在品牌公司的<em>資訊系統</em>。</p>
		<p>這些資料需要定期<strong>人工下載、比對</strong>，但是品牌公司會基於某些原因與理由不開放 API 讓系統之間串接，因此爬蟲成了資料下載的管道。</p>
		<p>一個工廠不會只生產一種產品，每種產品的零組件也不會只有幾十種。系統雖提供同一種下載模式（在同網站），但很多名稱不一定有規則，所以每個爬蟲程式多多少少需要一些客製化。<b>然後...然後...然後...</b></p>
	</section>

	<section class="slide">
		<figure>
			<img class="cover" src="pictures/heisdie.jpg" alt="law-in-shit">
		</figure>
	</section>

	<section class="slide">
		<h2>Story as background </h2>
		<figure>
			<blockquote>
				<p>電話響鈴聲～</p>
				<p>我：接起，您好我是 Jason</p>
				<p>對方：批哩啪拉，資料又不對了，產線停止了，拉拉拉。阿拉花瓜...</p>
				<p>我：現在檢查一下</p>
				<p>對方：掛斷</p>
			</blockquote>
		</figure>
	</section>

	<section class="slide">
		<figure>
			<img class="cover" src="pictures/blockman.jpeg" alt="wtf">
		</figure>
	</section>

	<section class="slide">
		<h2 class="shout shrink">排程任務<br>工具與框架</h2>
	</section>

	<section class="slide twocol l65">
		<ol>
			<li>首先先講一點點關於 Directed Acyclic Graph （ DAG ）的知識。</li>
			<li>有些事情會有先後關係，舉例資料結構內用 Graph 來表示，vertex(穿襪子)、vertex(穿鞋子)與edge(先後關係)：</li>
			<li>時間軸當作主角，緣起緣滅、緣聚緣散，凡事都是 DAG</li>
		</ol>
		<dir class="left">
			<div class="citation">
				<img class="fill w" src="pictures/graph1.png" alt="graph1">
				<p>這樣的 Graph 顯示在穿鞋子之前必須先套上襪子。</p>
			</div>
		</dir>
	</section>

	<section class="slide twocol l65">
		<ul>
			<li>選課系統要如何確保在選修「演算法分析」之前，已經先選修「資料結構」，而在選修「資料結構」之前，已經先修完「程式(一)」與「離散數學」？</li>
			<li>關於這件事會用 Topological Sort(拓撲排序) 的演算法。就能確保我們在執行某些事情時照著某種順序進行。</li>
		</ul>
		<div class="left">
			<div class="citation">
				<img class="fill w" src="pictures/graph2.png" alt="graph2">
			</div>
		</div>
	</section>

	<section class="slide twocol l65">
		<h2>Topological Sort (拓撲排序)</h2>
		<div class="right">
			<ul>
				<li>若 Directed Acyclic Graph(DAG) 中存在一條 edge(X,Y)，那麼序列中，vertex(X) 一定要在 vertex(Y) 之前出現。</li>
			</ul>
		</div>
		<div class="left">
			<div class="citation">
				<img class="fill w" src="pictures/graph3.png" alt="graph3">
				<p>edge(2,6)、edge(6,9)，那麼 Topological Sort 中，vertex(2) 一定要出現在 vertex(6) 之前，vertex(6) 一定要在 vertex(9) 前</p>
			</div>
		</div>
	</section>

	<section class="slide twocol l65">
		<div class="right">
			<p>實現一個排程的任務，就是要實作一個<em>DAG</em>。 而且有很多使用 <i>Python</i> 開發的 workflow system (有國外大大稍微整理一下，大約<code>&lt;130&gt;</code>個)。天啊！</p>
		</div>
		<div class="left">
			<div class="citation">
				<img class="fill w" src="pictures/workflow_list.png" alt="workflow_list">
				<p>Ref: <a href="https://github.com/common-workflow-language/common-workflow-language/wiki/Existing-Workflow-systems">Computational Data Analysis Workflow Systems</a></p>
			</div>
		</div>
	</section>

	<section class="slide twocol l65">
		<div class="right">
			<h2><a href="https://github.com/thieman/dagobah">Dagobah</a></h2>
			<ul>
				<li>一個用 Python 實作的 simple dependency-based job scheduler。</li>
				<li>採 cron 語法在網頁上設定 schedule 然後透過拖、拉、放的方式在網頁上連結不同 job 來建立任務。</li>
			</ul>
		</div>
		<div class="left">
			<div class="citation">
				<img class="fill w" src="pictures/dagobah.png" alt="dagobah">
			</div>
		</div>
	</section>

	<section class="slide twocol l65">
		<div class="right">
			<h2><a href="https://github.com/spotify/luigi">Luigi</a></h2>
			<ul>
				<li>Spotify 所開發的開源軟體。主要協助建立複雜與批次的 pipline jobs。</li>
				<li>優勢是用來處理高度相依的工作流程管理和可視覺化。分別用 Python 撰寫兩大模組達成。</li>
				<li>沒有提供 job task 的 schedule module。</li>
			</ul>
		</div>
		<div class="left">
			<div class="citation">
				<img class="fill w" src="pictures/luigi.png" alt="luigi">
			</div>
		</div>
	</section>

	<section class="slide twocol l65">
		<div class="right">
			<h2><a href="https://github.com/pinterest/pinball">Pinball</a></h2>
			<ul>
				<li>也是一個 workflow system 但比較特別是遵守 master-client (或是 master-worker) 的架構。所以它是透過 master 來管理例如 schedule, worker ….</li>
				<li>將 hadoop/hive/spark jobs 整合的很不錯。</li>
			</ul>
		</div>
		<div class="left">
			<div class="citation">
				<img class="fill w" src="pictures/pinball.png" alt="pinball">
			</div>
		</div>
	</section>

	<section class="slide twocol l65">
		<div class="right">
			<h2><a href="https://github.com/apache/incubator-airflow">Airflow</a></h2>
			<ul>
				<li>Airbnb 的開源軟體。採 Python 開發。與剛剛提到的 Luigi 和 Pinball 相似。</li>
				<li>後端主要是以 Flask 和 Celery 建立。</li>
			</ul>
		</div>
		<div class="left">
			<div class="citation">
				<img class="fill w" src="pictures/airflow.png" alt="airflow">
			</div>
		</div>
	</section>

	<section class="slide">
		<h2><a href="http://bytepawn.com/luigi-airflow-pinball.html">Luigi vs Airflow vs Pinball</a></h2>
		<table>
		<tr>
			<th scope="col"></th>
			<th>Luigi</th>
			<th>Airflow</th>
			<th>Pinball</th>
		</tr>
		<tr>
			<th scope="row">Fingerstache</th>
			<td>Kale</td>
			<td>Chips</td>
			<td>Keytar</td>
		</tr>
		<tr>
			<th scope="row">Sriracha</th>
			<td>Gluten-free</td>
			<td>Ennui</td>
			<td>Keffiyeh</td>
		</tr>
		<tr>
			<th scope="row">Thundercats</th>
			<td>Jean</td>
			<td>Shorts</td>
			<td>Biodiesel</td>
		</tr>
		<tr>
			<th scope="row">Terry</th>
			<td>Richardson</td>
			<td>Swag</td>
			<td>Blog</td>
		</tr>
		</table>
		<p>It’s good to have information organized.</p>
	</section>

	<section class="slide">
		<h2 class="shout">建立一個<br>排程任務網站</h2>
	</section>

	<section class="slide">
		<h2>RequirementS</h2>
		<ol>
			<li>需要一個簡單設定任務排程（整合起來不複雜）</li>
			<li class="next">可以把爬蟲的程式簡單的包進進去（模組化）</li>
			<li class="next">監控流程與狀態（開始運行提示、運行時的狀況）</li>
			<li class="next">簡單就做出來的前端頁面（也可說是熟悉）</li>
			<li class="next">最後...我就是想用 Django</li>
		</ol>
	</section>

	<section class="slide grid">
		<h2>Django 的套件從那找？</h2>
		<p>有一個挺好用的網站叫 <a href="https://djangopackages.org/grids/g/search/">Django Packages </a>網羅了許多<b> Django </b>套件，其中有一個分類叫：<em>Workers, Queues, and Tasks</em> 有列出很多相關的套件。</p>
		<div class="left">
			<div class="citation">
				<img class="fill w" src="pictures/djangopkg.png" alt="djpkg">
			</div>
		</div>
	</section>

	<section class="slide" id="picture">
		<h2>Pictures</h2>
		<figure>
			<img class="cover" src="pictures/pkglist.png" alt="pkglist">
		</figure>
		<style>
			#picture h2 {
				color:#FFF;
				}
		</style>
	</section>

	<section class="slide">
		<h2>Django 簡介與設定</h2>
		<figure>
			<blockquote>
				<p>Django Q is a <b>native</b> Django task queue, scheduler and worker application using Python multiprocessing.</p>
				<p>Django Q is tested with: Python 2.7 & 3.6. Django 1.8.18 LTS, 1.10.7 and 1.11</p>
			</blockquote>
		</figure>
	</section>

	<section class="slide">
		<h2>Feature</h2>
		<ul>
			<li>Multiprocessing worker pools</li>
			<li>Asynchronous tasks</li>
			<li>Scheduled and repeated tasks</li>
			<li>Encrypted and compressed packages</li>
			<li>Failure and success database or cache</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Feature</h2>
		<ul>
			<li>Result hooks, groups and chains</li>
			<li>Django Admin integration</li>
			<li>PaaS compatible with multiple instances</li>
			<li>Multi cluster monitor</li>
			<li>Redis, Disque, IronMQ, SQS, MongoDB or ORM</li>
			<li>Rollbar support</li>
		</ul>
	</section>









	<section class="slide">
		<h2>Two columns if you like</h2>
		<p class="double">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia.</p>
	</section>

	<section class="slide">
		<h2>All kind of lists</h2>
		<ol>
			<li>Simple lists are marked with bullets</li>
			<li>Ordered lists begin with a number</li>
			<li>You can even nest lists one inside another
				<ul>
					<li>Or mix their types</li>
					<li>But do not go too far</li>
					<li>Otherwise audience will be bored</li>
				</ul>
			</li>
			<li>Look, seven rows exactly!</li>
		</ol>
	</section>

	<section class="slide">
		<h2>Serious citations</h2>
		<figure>
			<blockquote>
				<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia.</p>
			</blockquote>
			<figcaption>Marcus Tullius Cicero</figcaption>
		</figure>
	</section>

	<section class="slide">
		<h2>Code samples</h2>
		<pre>
			<code>&lt;!DOCTYPE html&gt;</code>
			<code class="mark">&lt;html lang="en"&gt;</code>
			<code><mark>&lt;head&gt;</mark> <span class="comment">&lt;!--Comment--&gt;</span></code>
			<code>    &lt;title&gt;Shower&lt;/title&gt;</code>
			<code>    &lt;meta charset="<mark class="important">UTF-8</mark>"&gt;</code>
			<code>    &lt;link rel="stylesheet" href="screen.css"&gt;</code>
			<code><mark>&lt;/head&gt;</mark></code>
		</pre>
	</section>

	<section class="slide" id="picture">
		<h2>Pictures</h2>
		<figure>
			<img class="cover" src="pictures/picture.jpg" alt="Orange typewriter on a wooden table close-up">
			<figcaption class="white">
				<a href="http://fiftyfootshadows.net/">© John Carey</a>
			</figcaption>
		</figure>
		<style>
			#picture h2 {
				color:#FFF;
				}
		</style>
	</section>

	<section class="slide">
		<h2 class="shout shrink">You can even shout this way</h2>
	</section>

	<section class="slide">
		<h2>Inner navigation</h2>
		<ol>
			<li>Lets you reveal list items one by one</li>
			<li class="next">To keep some key points</li>
			<li class="next">In secret from audience</li>
			<li class="next">But it will work only once</li>
			<li class="next">Nobody wants to see the same joke twice</li>
		</ol>
	</section>

	<section class="slide" id="see-more">
		<h2 class="shout">
			<img src="pictures/logo.svg" alt="Shower logo">
			<a href="https://github.com/shower/shower">See more on GitHub</a>
		</h2>
		<style>
			#see-more h2 {
				font-size:100px
				}
			#see-more img {
				width:0.72em;
				height:0.72em;
				}
		</style>
	</section>

	<footer class="badge">
		<a href="https://github.com/chairco/2017Talk-Django-crawler-monitor">Fork me on GitHub</a>
	</footer>

	<div class="progress"></div>

	<!-- Library -->
	<!-- <script src="lib/shower/shower.min.js"></script>
	<script src="lib/highlight/highlight.pack.js" type="text/javascript" charset="utf-8"></script> -->
	<script>
		hljs.initHighlightingOnLoad();
	</script>
	<script src="shower/shower.min.js"></script>
	<!-- Copyright © 2017 Yours Truly, Famous Inc. -->

</body>
</html>
